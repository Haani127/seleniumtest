package runner;

import java.util.Set;

import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.testng.Assert;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.AfterTest;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import com.aventstack.extentreports.ExtentReports;
import com.aventstack.extentreports.ExtentTest;
import com.aventstack.extentreports.Status;

import utils.Base;
import utils.ExcelReader;
import utils.LoggerHandler;
import utils.Reporter;
import utils.Screenshot;
import utils.WebDriverHelper;

public class TestRunner extends Base {

    public static LoggerHandler loghandle;
    public static ExcelReader excel = new ExcelReader();
    public  static WebDriverHelper helper;
    public ExtentReports report;
    public ExtentTest test;

@BeforeMethod
    public void beforeMethod(){
        openBrowser();
        loghandle =  new LoggerHandler();
        helper = new WebDriverHelper(driver);
        report = Reporter.generateExtentReport("report"); 
    }
    
@Test
public void testOne() throws InterruptedException{

    test = report.createTest("click on Blog");
    helper.clickOnElement(By.xpath("//div[contains(text(),'Sign In / Registration')]"));
    Thread.sleep(3000);
    LoggerHandler.info("click on signin");

    helper.clickOnElement(By.xpath("//div[@class='portal-info']/a"));
    Thread.sleep(3000);

    helper.clickOnElement(By.xpath("//div[@class=\"our-companies-list\"]/a[1]"));
    Thread.sleep(3000);

    String parent = driver.getWindowHandle();

    Set<String>child = driver.getWindowHandles();

    for(String next : child){
        if (!next.equals(parent)) {
            driver.switchTo().window(next); 
            break;
        }
    }
    Thread.sleep(3000);
    helper.javascriptScroll(By.xpath("//div[@class=\"verified-dealer-title-wrapper\"]/a"));
    Thread.sleep(2000);
    helper.clickOnElement(By.xpath("//div[@class=\"verified-dealer-title-wrapper\"]/a"));
    Thread.sleep(1000);

    
    helper.clickOnElement(By.xpath("//div[@class='contact-with-dealer']/a"));
    Thread.sleep(2000);
    
    String text = driver.findElement(By.xpath("//div[@class=\"page-title\"]")).getText();
    
    
    Assert.assertEquals(text, "Contact the seller");

    Screenshot.captureScreenShot("agronetto_screenshot");
    Reporter.attachScreenshotToReport("agronetto_screenshot", test, "screenshot");
    test.log(Status.PASS, "took screenshot");
    Reporter.captureScreenShot("img3");
}

@Test
public void test2(){
    test = report.createTest("test-2");
    helper.javascriptScroll(By.xpath("//a[text()='Blog']"));
    test.log(Status.INFO, "click on Blog");
    LoggerHandler.info("click on blog");
    helper.clickOnElement(By.xpath("//a[text()='Blog']"));
    helper.hoverOverElement(By.xpath("(//div[text()='Blog about farm equipment'])[1]"));
    helper.clickOnElement(By.xpath("(//a[text()='Blog about warehouse equipment'])[1]"));
    helper.switchToNewWindow();
    helper.clickOnElement(By.xpath("(//a//span[text()='Business'])[1]"));
    Reporter.captureScreenShot("click on Blog");
    
}

@Test
public void test3(){
    helper.clickOnElement(By.xpath("//div[text()='Spare parts']"));
    driver.findElement(By.xpath("//input[@name='spcid']")).sendKeys("37178",Keys.ENTER);
    helper.clickOnElement(By.xpath("(//span[text()='Placed on'])[1]"));
    helper.clickOnElement(By.xpath("(//span[text()='Least expensive on top'])[1]"));
}

@AfterMethod
void down(){
    driver.quit();
}

@AfterTest
public void after(){
    report.flush();
}
    
    
}